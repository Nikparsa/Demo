<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Data Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f0f2f5;
            padding-top: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 10px;
            border: none;
        }
        .card-header {
            background-color: #e9f0ff;
            font-weight: bold;
            border-radius: 10px 10px 0 0 !important;
            padding: 12px 16px;
        }
        .card-body {
            padding: 20px;
            height: 300px; /* Fixed height for chart containers */
        }
        .response-time {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
        }
        .api-badge {
            margin-left: 10px;
            font-weight: normal;
            padding: 5px 10px;
        }
        .connection-status {
            border-radius: 50%;
            display: inline-block;
            height: 12px;
            width: 12px;
            margin-right: 5px;
        }
        .connected {
            background-color: #28a745;
            box-shadow: 0 0 5px #28a745;
        }
        .disconnected {
            background-color: #dc3545;
            box-shadow: 0 0 5px #dc3545;
        }
        .last-update {
            font-size: 0.8rem;
            color: #6c757d;
        }
        .demo-buttons {
            margin-bottom: 20px;
        }
        .timing-display {
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }
        .btn {
            padding: 8px 20px;
            font-weight: 500;
            margin: 0 5px;
            border-radius: 6px;
        }
        h1 {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Real-time Data Dashboard</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <span>Connection Status</span>
                        <span>
                            <span id="connection-icon" class="connection-status disconnected"></span>
                            <span id="connection-text">Disconnected</span>
                        </span>
                    </div>
                    <div class="card-body" style="height: auto;">
                        <div class="demo-buttons text-center">
                            <button id="connect-btn" class="btn btn-primary">Connect WebSocket</button>
                            <button id="disconnect-btn" class="btn btn-secondary" disabled>Disconnect</button>
                            <button id="sync-demo-btn" class="btn btn-danger">Run Sync Demo</button>
                            <button id="async-demo-btn" class="btn btn-success">Run Async Demo</button>
                        </div>
                        <div id="timing-display" class="timing-display">Run a demo to see timing comparison</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <!-- Weather Data -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <span>Temperature Data</span>
                        <span class="api-badge badge bg-info">Weather API</span>
                    </div>
                    <div class="card-body">
                        <canvas id="weatherChart"></canvas>
                        <div id="weather-response-time" class="response-time mt-2 text-end">
                            Response time: --
                        </div>
                    </div>
                    <div class="card-footer">
                        <small id="weather-last-update" class="last-update">Last update: --</small>
                    </div>
                </div>
            </div>
            
            <!-- Crypto Data -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <span>Cryptocurrency Prices</span>
                        <span class="api-badge badge bg-warning text-dark">Crypto API</span>
                    </div>
                    <div class="card-body">
                        <canvas id="cryptoChart"></canvas>
                        <div id="crypto-response-time" class="response-time mt-2 text-end">
                            Response time: --
                        </div>
                    </div>
                    <div class="card-footer">
                        <small id="crypto-last-update" class="last-update">Last update: --</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <!-- Stock Data -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <span>Stock Prices</span>
                        <span class="api-badge badge bg-success">Stock API</span>
                    </div>
                    <div class="card-body">
                        <canvas id="stockChart"></canvas>
                        <div id="stock-response-time" class="response-time mt-2 text-end">
                            Response time: --
                        </div>
                    </div>
                    <div class="card-footer">
                        <small id="stock-last-update" class="last-update">Last update: --</small>
                    </div>
                </div>
            </div>
            
            <!-- Server Stats -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <span>Server CPU Load</span>
                        <span class="api-badge badge bg-secondary">Server API</span>
                    </div>
                    <div class="card-body">
                        <canvas id="serverChart"></canvas>
                        <div id="server-response-time" class="response-time mt-2 text-end">
                            Response time: --
                        </div>
                    </div>
                    <div class="card-footer">
                        <small id="server-last-update" class="last-update">Last update: --</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dashboard JavaScript -->
    <script>
        // Chart objects
        let weatherChart, cryptoChart, stockChart, serverChart;
        
        // WebSocket connection
        let socket = null;
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            setupEventListeners();
        });
        
        // Set up event listeners for buttons
        function setupEventListeners() {
            document.getElementById('connect-btn').addEventListener('click', connectWebSocket);
            document.getElementById('disconnect-btn').addEventListener('click', disconnectWebSocket);
            document.getElementById('sync-demo-btn').addEventListener('click', runSyncDemo);
            document.getElementById('async-demo-btn').addEventListener('click', runAsyncDemo);
        }
        
        // Initialize all charts
        function initCharts() {
            // Common chart options
            Chart.defaults.font.size = 14;
            Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
            
            // Weather Chart
            const weatherCtx = document.getElementById('weatherChart').getContext('2d');
            weatherChart = new Chart(weatherCtx, {
                type: 'bar',
                data: {
                    labels: ['New York', 'London', 'Tokyo', 'Sydney', 'Berlin'],
                    datasets: [{
                        label: 'Temperature (Â°C)',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(32, 156, 238, 0.8)',
                        borderColor: 'rgba(32, 156, 238, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
            
            // Crypto Chart
            const cryptoCtx = document.getElementById('cryptoChart').getContext('2d');
            cryptoChart = new Chart(cryptoCtx, {
                type: 'line',
                data: {
                    labels: ['Bitcoin', 'Ethereum', 'Cardano', 'Solana', 'Dogecoin'],
                    datasets: [{
                        label: 'Price (USD)',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(255, 159, 64, 0.4)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.2,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(255, 159, 64, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
            
            // Stock Chart
            const stockCtx = document.getElementById('stockChart').getContext('2d');
            stockChart = new Chart(stockCtx, {
                type: 'line',
                data: {
                    labels: ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA'],
                    datasets: [{
                        label: 'Price (USD)',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(75, 192, 192, 0.4)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.2,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(75, 192, 192, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
            
            // Server Chart
            const serverCtx = document.getElementById('serverChart').getContext('2d');
            serverChart = new Chart(serverCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Server 1', 'Server 2', 'Server 3', 'Server 4'],
                    datasets: [{
                        label: 'CPU Load (%)',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Connect to WebSocket for real-time updates
        function connectWebSocket() {
            if (socket !== null) {
                return;
            }
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            socket = new WebSocket(wsUrl);
            
            socket.onopen = function(e) {
                updateConnectionStatus(true);
                document.getElementById('connect-btn').disabled = true;
                document.getElementById('disconnect-btn').disabled = false;
            };
            
            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                updateDashboard(data);
            };
            
            socket.onclose = function(event) {
                updateConnectionStatus(false);
                socket = null;
                document.getElementById('connect-btn').disabled = false;
                document.getElementById('disconnect-btn').disabled = true;
            };
            
            socket.onerror = function(error) {
                console.error('WebSocket Error:', error);
                updateConnectionStatus(false);
            };
        }
        
        // Disconnect from WebSocket
        function disconnectWebSocket() {
            if (socket !== null) {
                socket.close();
                socket = null;
            }
        }
        
        // Update connection status indicator
        function updateConnectionStatus(connected) {
            const icon = document.getElementById('connection-icon');
            const text = document.getElementById('connection-text');
            
            if (connected) {
                icon.classList.remove('disconnected');
                icon.classList.add('connected');
                text.textContent = 'Connected';
            } else {
                icon.classList.remove('connected');
                icon.classList.add('disconnected');
                text.textContent = 'Disconnected';
            }
        }
        
        // Run synchronous API demo
        function runSyncDemo() {
            const timingDisplay = document.getElementById('timing-display');
            timingDisplay.textContent = 'Running synchronous demo...';
            timingDisplay.style.color = '#dc3545';
            
            fetch('/sync')
                .then(response => response.json())
                .then(data => {
                    timingDisplay.textContent = `Synchronous approach took: ${data.total_time} seconds`;
                    
                    // Update charts with sync data
                    updateWeatherChart({data: data.weather});
                    updateCryptoChart({data: data.crypto});
                    updateStockChart({data: data.stocks});
                    updateServerChart({data: data.servers});
                })
                .catch(error => {
                    console.error('Error running sync demo:', error);
                    timingDisplay.textContent = 'Error running synchronous demo';
                });
        }
        
        // Run asynchronous API demo
        function runAsyncDemo() {
            const timingDisplay = document.getElementById('timing-display');
            timingDisplay.textContent = 'Running asynchronous demo...';
            timingDisplay.style.color = '#28a745';
            
            fetch('/async')
                .then(response => response.json())
                .then(data => {
                    timingDisplay.textContent = `Asynchronous approach took: ${data.total_time} seconds`;
                    
                    // Update dashboard with retrieved data
                    updateDashboard(data);
                })
                .catch(error => {
                    console.error('Error running async demo:', error);
                    timingDisplay.textContent = 'Error running asynchronous demo';
                });
        }
        
        // Update all charts with new data
        function updateDashboard(data) {
            if (data.weather) {
                updateWeatherChart(data.weather);
                document.getElementById('weather-response-time').textContent = 
                    `Response time: ${data.weather.response_time}s`;
                document.getElementById('weather-last-update').textContent = 
                    `Last update: ${data.weather.timestamp}`;
            }
            
            if (data.crypto) {
                updateCryptoChart(data.crypto);
                document.getElementById('crypto-response-time').textContent = 
                    `Response time: ${data.crypto.response_time}s`;
                document.getElementById('crypto-last-update').textContent = 
                    `Last update: ${data.crypto.timestamp}`;
            }
            
            if (data.stocks) {
                updateStockChart(data.stocks);
                document.getElementById('stock-response-time').textContent = 
                    `Response time: ${data.stocks.response_time}s`;
                document.getElementById('stock-last-update').textContent = 
                    `Last update: ${data.stocks.timestamp}`;
            }
            
            if (data.servers) {
                updateServerChart(data.servers);
                document.getElementById('server-response-time').textContent = 
                    `Response time: ${data.servers.response_time}s`;
                document.getElementById('server-last-update').textContent = 
                    `Last update: ${data.servers.timestamp}`;
            }
        }
        
        // Update Weather Chart
        function updateWeatherChart(weatherData) {
            if (!weatherData || !weatherData.data) return;
            
            const data = weatherData.data;
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            weatherChart.data.labels = labels;
            weatherChart.data.datasets[0].data = values;
            weatherChart.update();
        }
        
        // Update Crypto Chart
        function updateCryptoChart(cryptoData) {
            if (!cryptoData || !cryptoData.data) return;
            
            const data = cryptoData.data;
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            cryptoChart.data.labels = labels;
            cryptoChart.data.datasets[0].data = values;
            cryptoChart.update();
        }
        
        // Update Stock Chart
        function updateStockChart(stockData) {
            if (!stockData || !stockData.data) return;
            
            const data = stockData.data;
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            stockChart.data.labels = labels;
            stockChart.data.datasets[0].data = values;
            stockChart.update();
        }
        
        // Update Server Chart
        function updateServerChart(serverData) {
            if (!serverData || !serverData.data) return;
            
            const data = serverData.data;
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            serverChart.data.labels = labels;
            serverChart.data.datasets[0].data = values;
            serverChart.update();
        }
    </script>
</body>
</html> 